# routeify-express

`routeify-express` √© uma biblioteca npm que simplifica a cria√ß√£o de rotas no Express atrav√©s do uso de decorators em classes de controller.

[![npm version](https://badge.fury.io/js/routeify-express.svg)](https://www.npmjs.com/package/routeify-express)

## üì¶ Instala√ß√£o

Utilize o gerenciador de pacotes de sua prefer√™ncia para instalar:

```bash
pnpm add routeify-express
```

```bash
npm i routeify-express
```

Para poder utilizar os decorators, √© necess√°rio habilitar a op√ß√£o `experimentalDecorators` no seu `tsconfig.json`:

```json
{
  "compilerOptions": {
    "experimentalDecorators": true
  }
}
```

## Como usar?

Aqui est√° um exemplo b√°sico de como usar a biblioteca:

**1 - Criar um Controller**

`controller.ts`

```typescript
import { Controller, Get } from "routeify-express";

@Controller("hello")
class HelloController {
  @Get("world")
  execute() {
    return "Hello World!";
  }
}
```

**2Ô∏è - Aplicar o Controller ao seu servidor Express**

`main.ts`

```typescript
import { createExpressServer } from "routeify-express";
import { HelloController } from "./controller.ts";

const app = createExpressServer({
  controllers: [HelloController],
});

app.listen(3001, () => console.log("Servidor rodando na porta 3001"));
```

Com este setup, agora temos uma rota `GET /hello/world` que retorna `Hello World!`.

### Decorators

- `@Controller(path: string)`: Marca uma classe como um controller.
- `@Get(path: string)`: Define um m√©todo como um manipulador de requisi√ß√£o GET.
- `@Post(path: string)`: Define um m√©todo como um manipulador de requisi√ß√£o POST.
- `@Put(path: string)`: Define um m√©todo como um manipulador de requisi√ß√£o PUT.
- `@Delete(path: string)`: Define um m√©todo como um manipulador de requisi√ß√£o DELETE.
- `@Patch(path: string)`: Define um m√©todo como um manipulador de requisi√ß√£o PATCH.
- `@Status(code: number | StatusCodes)`: Define o status code da resposta. Pode ser usado em conjunto com os decorators de rota.
  ```typescript
  import { Status, StatusCodes, Controller, Post } from "routeify-express";
  @Controller("/users")
  class HelloController {
    @Post()
    @Status(StatusCodes.CREATED)
    createUser() {
      return "User created!";
    }
  }
  ```
- `@UseMiddleware(middleware: RequestHandler)`: Adiciona um middleware √† rota.

  ```typescript
  import {
    UseMiddleware,
    Controller,
    Get,
    Request,
    Response,
    NextFunction,
  } from "routeify-express";

  function logger(req: Request, res: Response, next: NextFunction) {
    console.log("Request...");
    next();
  }

  @Controller("/users")
  class HelloController {
    @Get()
    @UseMiddleware(logger)
    getUsers() {
      return "Users";
    }
  }
  ```

- `@BodyValidator(classValidator: class)`: Valida o corpo da requisi√ß√£o com a biblioteca `class-validator`.

  ```typescript
  import { IsString } from "class-validator";
  import { BodyValidator, Controller, Post } from "routeify-express";

  class CreateUserDto {
    @IsString()
    name: string;
  }

  @Controller("/users")
  class HelloController {
    @Post()
    @BodyValidator(CreateUserDto)
    createUser() {
      return "User created!";
    }
  }
  ```

  Para ultilizar o `BodyValidator` √© necess√°rio instalar a biblioteca `class-validator`;

  ```bash
  pnpm add class-validator
  ```

> [!TIP]
> üí° `StatusCodes` √© um enum com os status codes HTTP mais comuns. ele pode ser importado de dentro da biblioteca.

## Exeptions

A routeify-express fornece algumas exce√ß√µes customizadas para cen√°rios comuns em APIs.

### HttpException

- Classe base para todas as exce√ß√µes relacionadas √† API.
- Inclui propriedades para c√≥digo de status, mensagem e detalhes adicionais.

### Lista Completa de Exce√ß√µes Customizadas

- **BadRequestException (400 Bad Request)**: Erro para entrada de dados inv√°lida ou incompleta.
- **UnauthorizedException (401 Unauthorized)**: Erro de autentica√ß√£o, geralmente quando n√£o h√° credenciais v√°lidas.
- **ForbiddenException (403 Forbidden)**: Erro de autoriza√ß√£o, geralmente quando o usu√°rio n√£o tem permiss√£o para acessar o recurso.
- **NotFoundException (404 Not Found)**: Erro quando o recurso solicitado n√£o foi encontrado.
- **MethodNotAllowedException (405 Method Not Allowed)**: Erro quando o m√©todo HTTP utilizado n√£o √© permitido para o recurso.
- **ConflictException (409 Conflict)**: Erro quando h√° um conflito de dados, como tentar criar um registro com um ID j√° existente.
- **InternalServerErrorException (500 Internal Server Error)**: Erro inesperado no servidor.
- **NotImplementedException (501 Not Implemented)**: Erro quando a funcionalidade solicitada ainda n√£o foi implementada.
- **ServiceUnavailableException (503 Service Unavailable)**: Erro quando o servi√ßo est√° indispon√≠vel temporariamente.
- **GatewayTimeoutException (504 Gateway Timeout)**: Erro de tempo limite ao se comunicar com outro servi√ßo.
- **RequestTimeoutException (504 Request Timeout)**: Erro de tempo limite na requisi√ß√£o do cliente.
- **LengthRequiredException (400 Bad Request)**: Erro quando um campo obrigat√≥rio n√£o √© fornecido ou est√° vazio.
- **TooManyRequestsException (429 Too Many Requests)**: Erro quando o cliente excedeu a taxa de requisi√ß√µes permitida.

Exemplo de uso:

```typescript
import { Controller, Get, BadRequestException } from "routeify-express";

@Controller("hello")
class HelloController {
  @Get("world")
  execute() {
    throw new BadRequestException("Bad Request");
  }
}
```

Exemplo de resposta:

```json
{
  "message": "Bad Request",
  "status": 400
}
```

## Observa√ß√µes

- As exce√ß√µes customizadas da routeify-express estendem a classe HttpException.
- Voc√™ pode criar suas pr√≥prias exce√ß√µes customizadas extendendo a classe HttpException.
- Ao utilizar as exce√ß√µes customizadas, voc√™ pode personalizar a mensagem de erro e os detalhes da resposta HTTP.

Para mais exemplos, veja a pasta [example](https://github.com/piazin/routeify-express/tree/main/example)

## üìÑ Licen√ßa

[MIT](https://choosealicense.com/licenses/mit/)

## Autores

- [@piazin](https://www.github.com/piazin)
